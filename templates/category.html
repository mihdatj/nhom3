<!DOCTYPE html>
<html lang="vi">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh M·ª•c S·∫£n Ph·∫©m - Nh√≥m 3</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/category.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div class="header-top-content">
                    <div class="header-top-left">
                        <span><i class="fas fa-truck"></i> Freeship n·ªôi th√†nh H√† N·ªôi & H·ªì Ch√≠ Minh ƒë∆°n h√†ng 299.000‚Ç´</span>
                        <span><i class="fas fa-shipping-fast"></i> FreeShip to√†n qu·ªëc ƒë∆°n h√†ng 399K</span>
                    </div>
                    <div class="header-top-right">
                        <span><i class="fas fa-phone"></i> Hotline: 123456</span>
                        <a href="{% url 'cart' %}" style="cursor: pointer; text-decoration: none; color: inherit;"><i class="fas fa-shopping-cart"></i> Gi·ªè h√†ng</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-main">
            <div class="container">
                <div class="header-main-content">
                    <a href="{% url 'index' %}" style="text-decoration: none; color: inherit;">
                        <div class="logo">
                            <h1>Nh√≥m 3</h1>
                        </div>
                    </a>
                    <div class="search-bar">
                        <input type="text" placeholder="Nh·∫≠p √≠t nh·∫•t 3 k√Ω t·ª± ƒë·ªÉ t√¨m ki·∫øm">
                        <button class="search-btn"><i class="fas fa-search"></i></button>
                    </div>
                    <div class="header-actions">
                        <a href="{% url 'cart' %}" style="text-decoration: none; color: inherit;">
                            <div class="cart-icon" style="cursor: pointer;">
                                <i class="fas fa-shopping-cart"></i>
                                <span class="cart-count">0</span>
                            </div>
                        </a>
                        <button class="login-btn">ƒêƒÉng Nh·∫≠p</button>
                    </div>
                </div>
            </div>
        </div>
        <nav class="navbar">
            <div class="container">
                <ul class="nav-menu">
                    <li><a href="{% url 'index' %}"><i class="fas fa-home"></i> Trang Ch·ªß</a></li>
                    <li><a href="#" onclick="showRauCuQua(); return false;">Rau c·ªß qu·∫£</a></li>
                    <li><a href="#" onclick="showLienHe(); return false;">Li√™n H·ªá</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <a href="{% url 'index' %}">Trang Ch·ªß</a>
                <span>/</span>
                <span id="categoryName">Danh M·ª•c</span>
            </div>

            <!-- Category Header -->
            <div class="category-header">
                <h1 id="categoryTitle">Danh M·ª•c S·∫£n Ph·∫©m</h1>
                <p id="productCount">0 s·∫£n ph·∫©m</p>
            </div>

            <!-- Main Content with Sidebar -->
            <div class="category-content-wrapper">
                <!-- Sidebar Filters -->
                <aside class="category-sidebar">
                    <div class="sidebar-section">
                        <h3>Danh M·ª•c</h3>
                        <ul class="subcategory-list" id="subcategoryList">
                            <li class="active"><a href="#" onclick="return false;">T·∫•t C·∫£</a></li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3>Gi√°</h3>
                        <div class="price-filter">
                            <div class="price-inputs">
                                <input type="number" id="minPrice" placeholder="T·ª´" min="0">
                                <span>-</span>
                                <input type="number" id="maxPrice" placeholder="ƒê·∫øn" min="0">
                            </div>
                            <button class="apply-price-btn" onclick="applyPriceFilter()">√Åp d·ª•ng</button>
                        </div>
                        <div class="price-presets">
                            <button class="price-preset-btn" onclick="setPriceRange(0, 100000)">D∆∞·ªõi 100.000‚Ç´</button>
                            <button class="price-preset-btn" onclick="setPriceRange(100000, 500000)">100.000‚Ç´ - 500.000‚Ç´</button>
                            <button class="price-preset-btn" onclick="setPriceRange(500000, 1000000)">500.000‚Ç´ - 1.000.000‚Ç´</button>
                            <button class="price-preset-btn" onclick="setPriceRange(1000000, 5000000)">1.000.000‚Ç´ - 5.000.000‚Ç´</button>
                            <button class="price-preset-btn" onclick="setPriceRange(5000000, null)">Tr√™n 5.000.000‚Ç´</button>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>ƒê√°nh Gi√°</h3>
                        <div class="rating-filter">
                            <label class="rating-option">
                                <input type="checkbox" value="5" onchange="applyRatingFilter()">
                                <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span> <span>T·ª´ 5 sao</span>
                            </label>
                            <label class="rating-option">
                                <input type="checkbox" value="4" onchange="applyRatingFilter()">
                                <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span> <span>T·ª´ 4 sao</span>
                            </label>
                            <label class="rating-option">
                                <input type="checkbox" value="3" onchange="applyRatingFilter()">
                                <span class="stars">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</span> <span>T·ª´ 3 sao</span>
                            </label>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>Khuy·∫øn M√£i</h3>
                        <div class="promotion-filter">
                            <label class="promotion-option">
                                <input type="checkbox" value="discount" onchange="applyPromotionFilter()">
                                <span>C√≥ khuy·∫øn m√£i</span>
                            </label>
                            <label class="promotion-option">
                                <input type="checkbox" value="freeship" onchange="applyPromotionFilter()">
                                <span>Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn</span>
                            </label>
                        </div>
                    </div>
                </aside>

                <!-- Main Products Area -->
                <div class="category-main">
                    <!-- Filters and Sort Bar -->
                    <div class="filter-section">
                        <div class="filter-left">
                            <button class="filter-btn active" data-filter="all">T·∫•t C·∫£</button>
                            <button class="filter-btn" data-filter="discount">C√≥ Khuy·∫øn M√£i</button>
                            <button class="filter-btn" data-filter="new">M·ªõi Nh·∫•t</button>
                        </div>
                        <div class="sort-section">
                            <label>S·∫Øp x·∫øp theo:</label>
                            <select id="sortSelect">
                                <option value="default">M·∫∑c ƒë·ªãnh</option>
                                <option value="price-asc">Gi√°: Th·∫•p ƒë·∫øn Cao</option>
                                <option value="price-desc">Gi√°: Cao ƒë·∫øn Th·∫•p</option>
                                <option value="discount-desc">Gi·∫£m gi√° nhi·ªÅu nh·∫•t</option>
                                <option value="name-asc">T√™n: A-Z</option>
                                <option value="name-desc">T√™n: Z-A</option>
                            </select>
                        </div>
                    </div>

                    <!-- Products Grid -->
                    <div class="products-container">
                        <div class="products-grid" id="categoryProducts">
                            <!-- Products will be loaded by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <!-- Pagination will be generated by JavaScript -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>H·ªñ TR·ª¢ KH√ÅCH H√ÄNG</h3>
                    <ul>
                        <li><a href="#">C√°c c√¢u h·ªèi th∆∞·ªùng g·∫∑p</a></li>
                        <li><a href="#">H∆∞·ªõng d·∫´n ƒë·∫∑t h√†ng v√† thanh to√°n</a></li>
                        <li><a href="#">Ch√≠nh s√°ch giao h√†ng</a></li>
                        <li><a href="#">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
                        <li><a href="#">Thanh to√°n</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>V·ªÄ CH√öNG T√îI</h3>
                    <ul>
                        <li><a href="#">Gi·ªõi thi·ªáu</a></li>
                        <li><a href="#">Li√™n h·ªá</a></li>
                        <li><a href="#">Danh s√°ch c·ª≠a h√†ng</a></li>
                        <li><a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>T·ªîNG ƒê√ÄI CHƒÇM S√ìC KH√ÅCH H√ÄNG</h3>
                    <div class="contact-info">
                        <p><strong>Hotline:</strong> <a href="tel:123456">123456</a></p>
                        <p><strong>Ph√≤ng CSKH:</strong> 123456</p>
                        <p><strong>Ph√≤ng mua h√†ng:</strong> 123456</p>
                        <p><strong>Ph√≤ng k·∫ø to√°n:</strong> 123456</p>
                        <p><strong>Ph√≤ng HCNS:</strong> 123456</p>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>ƒê·ªäA CH·ªà C√ÅC TR·ª§ S·ªû</h3>
                    <div class="address-info">
                        <p><strong>Tr·ª• S·ªü Ch√≠nh H√† N·ªôi:</strong><br>
                        S·ªë 11 Kim ƒê·ªìng | Ph∆∞·ªùng Gi√°p B√°t | Qu·∫≠n Ho√†ng Mai | H√† N·ªôi</p>
                        <p><strong>Chi Nh√°nh TP.HCM:</strong><br>
                        S·ªë 02/B Khu Ph·ªë 3 | ƒê∆∞·ªùng Trung M·ªπ T√¢y 13 | Qu·∫≠n 12 | TP.HCM</p>
                        <p><strong>X∆∞·ªüng Ch·∫ø Bi·∫øn:</strong><br>
                        V·∫°n Ty | Th√°i B·∫£o | Gia B√¨nh | B·∫Øc Ninh</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Gi·ªè H√†ng</h2>
            <div id="cartItems"></div>
            <div class="cart-total">
                <p>T·ªïng ti·ªÅn: <span id="cartTotal">0 ‚Ç´</span></p>
                <a href="{% url 'cart' %}" class="checkout-btn" style="text-decoration: none; color: white; display: inline-block; padding: 10px 20px; background-color: #2d5016; border-radius: 4px;">Xem Gi·ªè H√†ng</a>
            </div>
        </div>
    </div>

    <script src="{% static 'js/script.js' %}?v={% now 'U' %}"></script>
    <script>
        // Function to wait for products to load
        function waitForProducts(callback, maxAttempts = 10, attempt = 0) {
            if (typeof products !== 'undefined' && Array.isArray(products) && products.length > 0) {
                console.log('‚úÖ Products loaded successfully:', products.length, 'products');
                
                // Update image paths in products data to use static files
                products.forEach(function(product) {
                    if (product.image && product.image.startsWith('img/')) {
                        product.image = '/static/images/img/' + product.image.substring(4);
                    } else if (product.image && !product.image.startsWith('/static/') && !product.image.startsWith('http')) {
                        product.image = '/static/images/' + product.image;
                    }
                });
                
                // Log all categories
                const allCategories = [...new Set(products.map(p => p.category).filter(c => c))];
                console.log('üìã Available categories:', allCategories);
                
                if (callback) callback();
            } else if (attempt < maxAttempts) {
                console.log(`‚è≥ Waiting for products... (attempt ${attempt + 1}/${maxAttempts})`);
                setTimeout(function() {
                    waitForProducts(callback, maxAttempts, attempt + 1);
                }, 100);
            } else {
                console.error('‚ùå Products failed to load after', maxAttempts, 'attempts');
                const container = document.getElementById('categoryProducts');
                if (container) {
                    container.innerHTML = '<p style="text-align: center; padding: 40px; color: #e74c3c;">L·ªói: Kh√¥ng th·ªÉ t·∫£i danh s√°ch s·∫£n ph·∫©m. Vui l√≤ng t·∫£i l·∫°i trang.</p>';
                }
            }
        }
        
        // Wait for products before loading category.js
        waitForProducts(function() {
            // Load category.js after products are ready
            const script = document.createElement('script');
            script.src = '{% static "js/category.js" %}';
            script.onload = function() {
                console.log('‚úÖ category.js loaded');
            };
            document.body.appendChild(script);
        });
    </script>
</body>
</html>

